// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

// ============================================
// User & Authentication
// ============================================

enum Role {
  ADMIN
  EDITOR
}

model User {
  id           String   @id @default(cuid())
  email        String   @unique
  passwordHash String
  name         String?
  role         Role     @default(EDITOR)
  isActive     Boolean  @default(true)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  @@map("users")
}

// ============================================
// Localization
// ============================================

model Locale {
  id         String   @id @default(cuid())
  code       String   @unique // e.g., "en", "az", "tr"
  name       String // e.g., "English", "Azerbaijani"
  nativeName String // e.g., "English", "AzÉ™rbaycan"
  flag       String? // e.g., "ðŸ‡ºðŸ‡¸", "ðŸ‡¦ðŸ‡¿"
  isRTL      Boolean  @default(false)
  isDefault  Boolean  @default(false)
  isEnabled  Boolean  @default(true)
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  // Relations
  pageTranslations         PageTranslation[]
  siteSettingsTranslations SiteSettingsTranslation[]

  @@map("locales")
}

// ============================================
// Pages
// ============================================

model Page {
  id        String   @id @default(cuid())
  slug      String   @unique // e.g., "home", "about", "services", "partners", "contact"
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  translations PageTranslation[]

  @@map("pages")
}

enum PageStatus {
  DRAFT
  PUBLISHED
}

model PageTranslation {
  id             String     @id @default(cuid())
  pageId         String
  localeCode     String
  title          String
  seoTitle       String?
  seoDescription String?
  ogImage        String?
  blocks         Json       @default("[]") // Array of content blocks
  status         PageStatus @default(DRAFT)
  updatedAt      DateTime   @updatedAt
  updatedBy      String? // User ID who last updated

  // Relations
  page   Page   @relation(fields: [pageId], references: [id], onDelete: Cascade)
  locale Locale @relation(fields: [localeCode], references: [code], onDelete: Cascade)

  @@unique([pageId, localeCode])
  @@map("page_translations")
}

// ============================================
// Site Settings
// ============================================

model SiteSettings {
  id             String   @id @default("1") // Singleton pattern - always ID "1"
  siteName       String?
  logoUrl        String?
  faviconUrl     String?
  defaultLocale  String   @default("en")
  contactEmail   String?
  contactPhone   String?
  contactAddress String?
  socialLinks    Json     @default("{}") // { linkedin: "...", twitter: "..." }
  updatedAt      DateTime @updatedAt

  // Relations
  translations SiteSettingsTranslation[]

  @@map("site_settings")
}

model SiteSettingsTranslation {
  id         String  @id @default(cuid())
  settingsId String
  localeCode String
  tagline    String?
  footerText String?

  // Relations
  settings SiteSettings @relation(fields: [settingsId], references: [id], onDelete: Cascade)
  locale   Locale       @relation(fields: [localeCode], references: [code], onDelete: Cascade)

  @@unique([settingsId, localeCode])
  @@map("site_settings_translations")
}

// ============================================
// Contact System
// ============================================

enum InquiryType {
  PATIENT  // Health / Medical tourism
  TOUR     // Azerbaijan tours
  BUSINESS // Pharma & B2B inquiries
}

enum SubmissionStatus {
  NEW
  ARCHIVED
  SPAM
}

model ContactRecipient {
  id        String   @id @default(cuid())
  label     String // e.g., "General Inquiries", "Pharma Team"
  email     String
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  routingRules ContactRoutingRule[]

  @@map("contact_recipients")
}

model ContactRoutingRule {
  id          String      @id @default(cuid())
  type        InquiryType @unique // PHARMA, PATIENT, WELLNESS
  recipientId String
  isActive    Boolean     @default(true)
  updatedAt   DateTime    @updatedAt

  // Relations
  recipient ContactRecipient @relation(fields: [recipientId], references: [id], onDelete: Cascade)

  @@map("contact_routing_rules")
}

model ContactSubmission {
  id        String           @id @default(cuid())
  name      String
  email     String
  phone     String?
  type      InquiryType
  message   String
  locale    String           @default("en")
  pagePath  String?
  status    SubmissionStatus @default(NEW)
  meta      Json? // { userAgent, referrer, ip }
  createdAt DateTime         @default(now())

  @@map("contact_submissions")
}

// ============================================
// Partners
// ============================================

enum PartnerStatus {
  ACTIVE
  INACTIVE
}

model Partner {
  id          String        @id @default(cuid())
  name        String
  logoUrl     String?
  images      String[]      @default([]) // Array of Vercel Blob URLs for gallery
  location    String?
  specialties String[]      @default([])
  websiteUrl  String?
  category    String?       // "government" | "hospital" | "pharma" | "hotel" | "wellness"
  status      PartnerStatus @default(ACTIVE)
  order       Int           @default(0)
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt

  // Relations
  translations PartnerTranslation[]

  @@map("partners")
}

model PartnerTranslation {
  id          String  @id @default(cuid())
  partnerId   String
  localeCode  String
  description String?

  // Relations
  partner Partner @relation(fields: [partnerId], references: [id], onDelete: Cascade)

  @@unique([partnerId, localeCode])
  @@map("partner_translations")
}

// ============================================
// FAQ System
// ============================================

model FaqGroup {
  id        String   @id @default(cuid())
  key       String   @unique // "home", "services", "partners", "contact"
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  items FaqItem[]

  @@map("faq_groups")
}

model FaqItem {
  id        String   @id @default(cuid())
  groupId   String
  order     Int      @default(0)
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  group        FaqGroup             @relation(fields: [groupId], references: [id], onDelete: Cascade)
  translations FaqItemTranslation[]

  @@map("faq_items")
}

model FaqItemTranslation {
  id         String @id @default(cuid())
  faqItemId  String
  localeCode String
  question   String
  answer     String @db.Text

  // Relations
  faqItem FaqItem @relation(fields: [faqItemId], references: [id], onDelete: Cascade)

  @@unique([faqItemId, localeCode])
  @@map("faq_item_translations")
}

// ============================================
// Gallery System
// ============================================

model GalleryGroup {
  id        String   @id @default(cuid())
  key       String   @unique // "health-tourism" | "wellness" | "tours" | "vehicles" | "hotels"
  images    Json     @default("[]") // [{url, alt, order}]
  updatedAt DateTime @updatedAt

  @@map("gallery_groups")
}
